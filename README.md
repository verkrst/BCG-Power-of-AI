# ðŸŒ¾ ClientCo â€” Barley Yield & ESG Risk Dashboard

An **XGBoost-powered Streamlit dashboard** that predicts French barley yields under different climate scenarios and translates them into actionable supply-chain, ESG, and procurement insights for ClientCo.
---

## ðŸ“Œ Problem Statement

ClientCo sources barley from across France. Climate change is altering temperature, precipitation, and drought patterns â€” directly impacting barley yields. The company needs to:

1. **Quantify supply risk** at the department level under different climate futures
2. **Estimate financial & ESG impacts** (sourcing spend, COâ‚‚e per ton)
3. **Generate actionable recommendations** for procurement, ESG, and operations teams

---

## ðŸ—ï¸ Project Architecture

```
.
â”œâ”€â”€ app.py                      # Streamlit dashboard (main entry point)
â”œâ”€â”€ prepare_predictions.py      # Data pipeline + model training + prediction generation
â”œâ”€â”€ requirements.txt            # Python dependencies
â”œâ”€â”€ departements.geojson        # France departments GeoJSON (mainland)
â”œâ”€â”€ dataset/
â”‚   â”œâ”€â”€ barley_yield_from_1982.csv       # Historical barley yield/area/production
â”‚   â”œâ”€â”€ climate_data_from_1982.parquet   # CMIP6 climate data (historical + SSP projections)
â”‚   â””â”€â”€ predictions.csv                  # Pre-computed predictions (generated by prepare_predictions.py)
â”œâ”€â”€ eda.ipynb                   # Final notebook
â””â”€â”€ Modelling.ipynb             # Additional modelling experiments
```

---

## ðŸ“Š Data Sources

| Dataset | Description | Format |
|---------|-------------|--------|
| **Barley yield data** | Department-level yield (t/ha), area (ha), production (tons) from 1982 onwards | CSV (`;` separator) |
| **CMIP6 climate data** | Daily near-surface temperature, daily max temperature, precipitation per department | Parquet |
| **France GeoJSON** | Department boundaries from [gregoiredavid/france-geojson](https://github.com/gregoiredavid/france-geojson) | GeoJSON |

### Climate Scenarios (CMIP6 SSP)

| Scenario | Description |
|----------|-------------|
| **SSP1-2.6** | Optimistic â€” strong mitigation |
| **SSP2-4.5** | Middle road â€” moderate mitigation |
| **SSP5-8.5** | Pessimistic â€” high emissions |

---

## ðŸ¤– Model

### XGBoost Regressor (`xgb2`)

**Target**: Barley yield (t/ha) per department per year

**Features** (growing season: Marchâ€“July):

| Feature | Description |
|---------|-------------|
| `tmean_gs` | Mean temperature during growing season (Â°C) |
| `tmax_gs` | Mean daily max temperature (Â°C) |
| `prcp_gs` | Total precipitation (mm) |
| `hot_days` | Number of days with Tmax > 30Â°C |
| `gdd` | Growing Degree Days (base 5Â°C) |
| `max_consec_dry` | Longest consecutive dry spell (days < 1 mm) |
| `year` | Calendar year (captures yield trend) |
| `dep_norm_*` | One-hot encoded department dummies |

**Hyperparameters**:
- `n_estimators`: 1500
- `learning_rate`: 0.03
- `max_depth`: 5
- `subsample`: 0.8
- `colsample_bytree`: 0.8

**Train/Test Split**: Train on years < 2011, test on 2011+

---

## ðŸ–¥ï¸ Dashboard Features

### 1. National KPI Cards
Three headline metrics with evolution vs 2004â€“2014 baseline:
- **Predicted Total Production** (M tons)
- **Est. Sourcing Spend** (â‚¬M) â€” adjustable via price slider
- **Est. COâ‚‚e per Ton** (kg) â€” based on fixed 2,500 kg COâ‚‚e/ha emission factor

### 2. Interactive Choropleth Map
- Department-level **yield change (%)** vs baseline
- 5 discrete color bins (red â†’ yellow â†’ green)
- Hover tooltips: yield, baseline, production

### 3. Department Detail Panel
- Select any department for drill-down KPIs
- Yield change, predicted vs baseline yield, production, COâ‚‚e per ton

### 4. Risk-to-Action Quadrant Chart
- **X-axis**: Risk (yield change % for selected year)
- **Y-axis**: Exposure (department's share of national production)
- 4 quadrants with color-coded dots:
  - **Q1 â€” Core Crisis Zone**: High exposure + high risk â†’ deep adaptation
  - **Q2 â€” Strategic Base**: High exposure + low risk â†’ optimise & expand
  - **Q3 â€” Marginal High-Risk**: Low exposure + high risk â†’ agile procurement
  - **Q4 â€” Long-Tail Safe**: Low exposure + low risk â†’ monitor & comply

### 5. Action Pack Cards
- Per-department recommendations based on quadrant assignment
- Covers **ESG & Farmer Support**, **Procurement & Supply Chain**, and **Farmer Empowerment**

### Sidebar Controls
- **Climate Scenario** selector (SSP1-2.6 / SSP2-4.5 / SSP5-8.5)
- **Barley Market Price** slider (â‚¬130â€“400/ton)
- **Year** slider (forecast year selection)

---

## ðŸš€ Quick Start

### 1. Clone the repository

```bash
git clone https://github.com/verkrst/BCG-Power-of-AI.git
```

### 2. Install dependencies

```bash
pip install -r requirements.txt
```

### 3. Generate predictions (one-time)

```bash
python prepare_predictions.py
```

This trains the XGBoost model on historical data and generates `dataset/predictions.csv` (~9,300 rows covering all departments Ã— years Ã— scenarios).

### 4. Launch the dashboard

```bash
streamlit run app.py
```

---


## ðŸ“ Notebooks

| Notebook | Purpose |
|----------|---------|
| `eda.ipynb` | Initial exploratory data analysis |
| `eda_final.ipynb` | Final consolidated EDA with feature engineering |
| `model_map.ipynb` | XGBoost model training, evaluation & choropleth maps |
| `eda_resilience.ipynb` | Composite resilience index (exploratory, not used in dashboard) |
| `Modelling.ipynb` | Additional modelling experiments |

---

## ðŸ› ï¸ Tech Stack

- **Python 3.9+**
- **Streamlit** â€” interactive web dashboard
- **XGBoost** â€” gradient boosted tree model
- **Plotly** â€” interactive maps (Choroplethmapbox) & charts
- **Pandas / NumPy** â€” data processing
- **PyArrow** â€” Parquet file I/O

---

## ðŸ‘¥ Team

Built as part of a consulting engagement for **ClientCo** to support ESG-aligned barley sourcing strategy under climate uncertainty.

---

## ðŸ“„ License

This project is for educational and consulting purposes. Please refer to the repository license for usage terms.
